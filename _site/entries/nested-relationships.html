<!DOCTYPE html>
<html>
    <head>
        

<meta charset="UTF-8">
<title>JSONAPI Suite</title>
<meta name="viewport" content="width=device-width">
<meta name="author" content="">
<link rel="stylesheet" href="css/main.css">
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:500,600' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />

    </head>

    <body>
        <div class="container">
            <div class="overview" style='background-image: url("img/vertical_cloth.png") !important'>
                <span class="toggle">close</span>
                <header>
  <span>JSONAPI Suite</span>
</header>

                <ul id="nav">
    
    
    <li  class="parent current">
        <a href="#intro">Introduction</a>
        
            <ul>
                
                
                    <li >
                        <a href="#features">Features</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li >
        <a href="#installation">Installation</a>
        
    </li>
    
    <li  class="parent">
        <a href="#quickstart">Quickstart</a>
        
            <ul>
                
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#reads">Reads</a>
        
            <ul>
                
                
                    <li >
                        <a href="#resource-introduction">Resources</a>
                        
                    </li>
                
                    <li >
                        <a href="#filtering">Filtering</a>
                        
                    </li>
                
                    <li >
                        <a href="#sorting">Sorting</a>
                        
                    </li>
                
                    <li >
                        <a href="#pagination">Pagination</a>
                        
                    </li>
                
                    <li >
                        <a href="#default-filters">Default Filters</a>
                        
                    </li>
                
                    <li class="parent">
                        <a href="#sideloading">Sideloading</a>
                        
                            <ul>
                                
                                
                                <li>
                                    <a href="#sideloading-introduction">Introduction</a>
                                </li>
                                
                                <li>
                                    <a href="#sideloading-activerecord">ActiveRecord</a>
                                </li>
                                
                                <li>
                                    <a href="#advanced-activerecord">Advanced ActiveRecord</a>
                                </li>
                                
                                <li>
                                    <a href="#association-queries">Querying Associations</a>
                                </li>
                                
                            </ul>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#writes">Writes</a>
        
            <ul>
                
                
                    <li >
                        <a href="#custom-writes">Custom Writes</a>
                        
                    </li>
                
                    <li >
                        <a href="#validations">Validations</a>
                        
                    </li>
                
                    <li >
                        <a href="#strong_resources">Strong Resources</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#error-handling">Error Handling</a>
        
            <ul>
                
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#spec-helpers">Spec Helpers</a>
        
            <ul>
                
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#jsonapi-plus">JSON API Plus</a>
        
            <ul>
                
                
                    <li >
                        <a href="#nested-relationships">Nested Relationships</a>
                        
                    </li>
                
                    <li >
                        <a href="#extra-fields">Extra Fields</a>
                        
                    </li>
                
                    <li >
                        <a href="#stats">Stats</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#customize">Customize</a>
        
            <ul>
                
                
                    <li >
                        <a href="#resource-dsl">Resource DSL</a>
                        
                    </li>
                
                    <li >
                        <a href="#adapters">Adapters</a>
                        
                    </li>
                
                    <li >
                        <a href="#elasticsearch">ElasticSearch</a>
                        
                    </li>
                
                    <li >
                        <a href="#without-rails">Usage Without Rails</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
</ul>
            </div>

            <div class="content">
                <span class="toggle">open</span>
                <p>We’ve already mentioned nested relationships, but this is actually not
currently part of the core JSON API spec. We accept PUT or POST
payloads with nested attributes. The payload is the same as a
sideloaded response, with the addition of a <code class="highlighter-rouge">method</code> (called “sideposting”). Here we’ll update
an employee and position, while destroying the department for that
position. If any of these error or fail validations, the transaction
will be rolled back:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="ss">data: </span><span class="p">{</span>
    <span class="ss">id: </span><span class="s1">'1'</span><span class="p">,</span>
    <span class="ss">type: </span><span class="s1">'employees'</span><span class="p">,</span>
    <span class="ss">attributes: </span><span class="p">{</span> <span class="ss">name: </span><span class="s1">'Homer Simpson'</span> <span class="p">},</span>
    <span class="ss">relationships: </span><span class="p">{</span>
      <span class="ss">positions: </span><span class="p">{</span>
        <span class="ss">data: </span><span class="p">[</span>
          <span class="p">{</span>
            <span class="ss">type: </span><span class="s1">'positions'</span><span class="p">,</span>
            <span class="ss">id: </span><span class="s1">'1'</span><span class="p">,</span>
            <span class="ss">method: </span><span class="s1">'update'</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="ss">included: </span><span class="p">[</span>
    <span class="p">{</span>
      <span class="ss">id: </span><span class="s1">'1'</span><span class="p">,</span>
      <span class="ss">type: </span><span class="s1">'positions'</span><span class="p">,</span>
      <span class="ss">attributes: </span><span class="p">{</span> <span class="ss">title: </span><span class="s1">'Software Engineer'</span> <span class="p">},</span>
      <span class="ss">relationships: </span><span class="p">{</span>
        <span class="ss">department: </span><span class="p">{</span>
          <span class="ss">data: </span><span class="p">{</span>
            <span class="ss">id: </span><span class="s1">'1'</span><span class="p">,</span>
            <span class="ss">type: </span><span class="s1">'departments'</span><span class="p">,</span>
            <span class="ss">method: </span><span class="s1">'destroy'</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="ss">id: </span><span class="s1">'1'</span><span class="p">,</span>
      <span class="ss">type: </span><span class="s1">'departments'</span><span class="p">,</span>
      <span class="ss">attributes: </span><span class="p">{</span> <span class="ss">name: </span><span class="s1">'Safety'</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre>
</div>

<p>When creating nested records, we accept a <code class="highlighter-rouge">temp-id</code> - this is so the
client can match up the record they sent with the now-persisted record
in the response. Here we’ll create an employee, position, and
department all in one go.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="ss">data: </span><span class="p">{</span>
    <span class="ss">type: </span><span class="s1">'employees'</span><span class="p">,</span>
    <span class="ss">attributes: </span><span class="p">{</span> <span class="ss">name: </span><span class="s1">'Homer Simpson'</span> <span class="p">},</span>
    <span class="ss">relationships: </span><span class="p">{</span>
      <span class="ss">positions: </span><span class="p">{</span>
        <span class="ss">data: </span><span class="p">[</span>
          <span class="p">{</span>
            <span class="ss">type: </span><span class="s1">'positions'</span><span class="p">,</span>
            <span class="n">temp</span><span class="o">-</span><span class="ss">id: </span><span class="s1">'s0m3uu1d'</span><span class="p">,</span>
            <span class="ss">method: </span><span class="s1">'create'</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="ss">included: </span><span class="p">[</span>
    <span class="p">{</span>
      <span class="n">temp</span><span class="o">-</span><span class="ss">id: </span><span class="s1">'s0m3uu1d'</span><span class="p">,</span>
      <span class="ss">type: </span><span class="s1">'positions'</span><span class="p">,</span>
      <span class="ss">attributes: </span><span class="p">{</span> <span class="ss">title: </span><span class="s1">'Software Engineer'</span> <span class="p">},</span>
      <span class="ss">relationships: </span><span class="p">{</span>
        <span class="ss">department: </span><span class="p">{</span>
          <span class="ss">data: </span><span class="p">{</span>
            <span class="n">temp</span><span class="o">-</span><span class="ss">id: </span><span class="s1">'an0th3ruu1d'</span>
            <span class="ss">type: </span><span class="s1">'departments'</span><span class="p">,</span>
            <span class="ss">method: </span><span class="s1">'create'</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="n">temp</span><span class="o">-</span><span class="ss">id: </span><span class="s1">'an0th3ruu1d'</span><span class="p">,</span>
      <span class="ss">type: </span><span class="s1">'departments'</span><span class="p">,</span>
      <span class="ss">method: </span><span class="s1">'create'</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre>
</div>

<p>To accomodate this payload:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EmployeesController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">employee</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">jsonapi_create</span><span class="p">.</span><span class="nf">to_a</span>

    <span class="k">if</span> <span class="n">success</span>
      <span class="n">render_jsonapi</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span> <span class="ss">scope: </span><span class="kp">false</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">render_errors_for</span><span class="p">(</span><span class="n">employee</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="n">employee</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">jsonapi_update</span><span class="p">.</span><span class="nf">to_a</span>

    <span class="k">if</span> <span class="n">success</span>
      <span class="n">render_jsonapi</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span> <span class="ss">scope: </span><span class="kp">false</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">render_errors_for</span><span class="p">(</span><span class="n">employee</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>And add a <code class="highlighter-rouge">model</code> to your corresponding <code class="highlighter-rouge">Resource</code>:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EmployeeResource</span> <span class="o">&lt;</span> <span class="no">ApplicationResource</span>
  <span class="c1"># ... code ...</span>
  <span class="n">model</span> <span class="no">Employee</span>
<span class="k">end</span>
</code></pre>
</div>

<p>See the <a href="https://gist.github.com/richmolj/c7f1adca75f614bb71b27f259ff3c37a#writes">tutorial on writes</a> for information on how to customize various write operations, whitelist parameters, nested validations, and more.</p>

<div style="height: 3rem"></div>
<div class="note info">
  <h6 id="ensure-deletedestroy-are-whitelisted">Ensure _delete/_destroy are whitelisted</h6>
  <div class="note-content">
    <p><a href="https://github.com/jsonapi-suite/strong_resources">strong_resources</a> requires you to whitelist <code class="highlighter-rouge">_delete</code> and <code class="highlighter-rouge">_destroy</code>.
  This is pretty simple to do:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">strong_resource</span> <span class="ss">:employee</span> <span class="k">do</span>
  <span class="n">belongs_to</span> <span class="ss">:department</span><span class="p">,</span> <span class="ss">delete: </span><span class="kp">true</span> <span class="k">do</span>
    <span class="n">has_many</span> <span class="ss">:goals</span><span class="p">,</span> <span class="ss">destroy: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
    </div>
  </div>
</div>
<div style="height: 20rem"></div>

            </div>
        </div>

        <script src="js/jquery-2.1.1.min.js"></script>
        <script scr="js/jquery.scrollTo.js"></script>
        <script src="js/jquery.nav.js"></script>
        <script src="js/scripts.js"></script>
    </body>
</html>
