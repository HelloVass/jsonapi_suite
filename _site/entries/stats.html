<!DOCTYPE html>
<html>
    <head>
        

<meta charset="UTF-8">
<title>JSONAPI Suite</title>
<meta name="viewport" content="width=device-width">
<meta name="author" content="">
<link rel="stylesheet" href="css/main.css">
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:500,600' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />

    </head>

    <body>
        <div class="container">
            <div class="overview" style='background-image: url("img/vertical_cloth.png") !important'>
                <span class="toggle">close</span>
                <header>
  <span>JSONAPI Suite</span>
</header>

                <ul id="nav">
    
    
    <li  class="parent current">
        <a href="#intro">Introduction</a>
        
            <ul>
                
                
                    <li >
                        <a href="#features">Features</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li >
        <a href="#installation">Installation</a>
        
    </li>
    
    <li  class="parent">
        <a href="#quickstart">Quickstart</a>
        
            <ul>
                
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#reads">Reads</a>
        
            <ul>
                
                
                    <li >
                        <a href="#resource-introduction">Resources</a>
                        
                    </li>
                
                    <li >
                        <a href="#filtering">Filtering</a>
                        
                    </li>
                
                    <li >
                        <a href="#sorting">Sorting</a>
                        
                    </li>
                
                    <li >
                        <a href="#pagination">Pagination</a>
                        
                    </li>
                
                    <li >
                        <a href="#default-filters">Default Filters</a>
                        
                    </li>
                
                    <li class="parent">
                        <a href="#sideloading">Sideloading</a>
                        
                            <ul>
                                
                                
                                <li>
                                    <a href="#sideloading-introduction">Introduction</a>
                                </li>
                                
                                <li>
                                    <a href="#sideloading-activerecord">ActiveRecord</a>
                                </li>
                                
                                <li>
                                    <a href="#advanced-activerecord">Advanced ActiveRecord</a>
                                </li>
                                
                                <li>
                                    <a href="#association-queries">Querying Associations</a>
                                </li>
                                
                            </ul>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#writes">Writes</a>
        
            <ul>
                
                
                    <li >
                        <a href="#custom-writes">Custom Writes</a>
                        
                    </li>
                
                    <li >
                        <a href="#validations">Validations</a>
                        
                    </li>
                
                    <li >
                        <a href="#strong_resources">Strong Resources</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#error-handling">Error Handling</a>
        
            <ul>
                
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#spec-helpers">Spec Helpers</a>
        
            <ul>
                
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#jsonapi-plus">JSON API Plus</a>
        
            <ul>
                
                
                    <li >
                        <a href="#nested-relationships">Nested Relationships</a>
                        
                    </li>
                
                    <li >
                        <a href="#extra-fields">Extra Fields</a>
                        
                    </li>
                
                    <li >
                        <a href="#stats">Stats</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
    <li  class="parent">
        <a href="#customize">Customize</a>
        
            <ul>
                
                
                    <li >
                        <a href="#resource-dsl">Resource DSL</a>
                        
                    </li>
                
                    <li >
                        <a href="#adapters">Adapters</a>
                        
                    </li>
                
                    <li >
                        <a href="#elasticsearch">ElasticSearch</a>
                        
                    </li>
                
                    <li >
                        <a href="#without-rails">Usage Without Rails</a>
                        
                    </li>
                
            </ul>
        
    </li>
    
</ul>
            </div>

            <div class="content">
                <span class="toggle">open</span>
                <p>Imagine a grid listing records. The <a href="https://jsonapi-suite.github.io/jsonapi_suite/#reads">Reads</a> section covers populating the grid, but what about “X total records”, or “average cost”?</p>

<p>These calculations are supported via <code class="highlighter-rouge">allow_stat</code>:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EmployeeResource</span> <span class="o">&lt;</span> <span class="no">JsonapiCompliable</span><span class="o">::</span><span class="no">Resource</span>
  <span class="n">type</span> <span class="ss">:employees</span>
  <span class="n">use_adapter</span> <span class="no">JsonapiCompliable</span><span class="o">::</span><span class="no">Adapters</span><span class="o">::</span><span class="no">ActiveRecord</span>

  <span class="n">allow_stat</span> <span class="ss">total: </span><span class="p">[</span><span class="ss">:count</span><span class="p">]</span>
<span class="k">end</span>
</code></pre>
</div>

<p>A GET to <code class="highlighter-rouge">/api/employees?stats[total]=count</code> would return:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="ss">data: </span><span class="p">[.</span><span class="nf">.</span><span class="o">.</span><span class="p">],</span>
  <span class="ss">meta: </span><span class="p">{</span>
    <span class="ss">stats: </span><span class="p">{</span>
      <span class="ss">total: </span><span class="p">{</span>
        <span class="ss">count: </span><span class="mi">100</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>A few ‘default calculations’ are provided: <code class="highlighter-rouge">count</code>, <code class="highlighter-rouge">sum</code>, <code class="highlighter-rouge">average</code>,
<code class="highlighter-rouge">maximum</code> and <code class="highlighter-rouge">minimum</code>. These will work out-of-the-box with ActiveRecord.
Alternatively, override these calculation functions:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">allow_stat</span> <span class="ss">:salary</span> <span class="k">do</span>
  <span class="n">average</span> <span class="p">{</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="kp">attr</span><span class="o">|</span> <span class="n">scope</span><span class="p">.</span><span class="nf">average</span><span class="p">(</span><span class="kp">attr</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Or support your own custom calculations:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">allow_stat</span> <span class="ss">salary: </span><span class="p">[</span><span class="ss">:average</span><span class="p">]</span> <span class="k">do</span>
  <span class="n">standard_deviation</span> <span class="p">{</span> <span class="o">|</span><span class="n">scope</span><span class="p">,</span> <span class="kp">attr</span><span class="o">|</span> <span class="p">.</span><span class="nf">.</span><span class="o">.</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Multiple stats are supported with one request:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">GET</span> <span class="sr">/api/em</span><span class="n">ployees?stats</span><span class="p">[</span><span class="n">salary</span><span class="p">]</span><span class="o">=</span><span class="n">average</span><span class="p">,</span><span class="n">maximum</span><span class="o">&amp;</span><span class="n">stats</span><span class="p">[</span><span class="n">total</span><span class="p">]</span><span class="o">=</span><span class="n">count</span>
</code></pre>
</div>

<p>If you want <strong>only</strong> stats, and no records (for performance), simple pass page size 0:</p>

<p><code class="highlighter-rouge">GET /api/employees?stats[salary]=average&amp;page[size]=0</code></p>

<div class="note info">
  <h6 id="further-reading">Further Reading</h6>
  <div class="note-content">
    <p>To learn more about the stats API, see
  <a href="https://github.com/jsonapi-suite/jsonapi_compliable">jsonapi_compliable</a></p>
  </div>
</div>
<div style="height: 5rem"></div>

            </div>
        </div>

        <script src="js/jquery-2.1.1.min.js"></script>
        <script scr="js/jquery.scrollTo.js"></script>
        <script src="js/jquery.nav.js"></script>
        <script src="js/scripts.js"></script>
    </body>
</html>
