<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>JSONAPI Suite</title>
  <meta name="description" content="Collection of Ruby libraries for powering JSONAPI-compliant APIs.">

  <link rel="stylesheet" type="text/css" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
  <link rel="stylesheet" href="http://localhost:4000/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/quickstart.html">
  <link rel="alternate" type="application/rss+xml" title="JSONAPI Suite" href="/feed.xml">

  <!-- javascript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>

  
</head>


  <body>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <header class="navbar navbar-inverse normal" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="index.html" class="navbar-brand">JSONAPI Suite</a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a class="nav-link" href="http://localhost:4000/quickstart">Quickstart</a>
        </li>
        <li>
          <a class="nav-link" href="http://localhost:4000/tutorial">Tutorial</a>
        </li>
        <li class="dropdown">
          <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">
            How-Tos
            <b class="caret"></b>
          </a>

          <ul class="dropdown-menu">
            <li>
              <a href="http://localhost:4000/how-to-scope-to-current-user">Scope to Current User</a>
            </li>
            <li>
              <a href="http://localhost:4000/how-to-cause-side-effects">Cause Side Effects</a>
            </li>
          </ul>
        </li>
        <li>
          <a class="nav-link" href="mailto:richmolj@gmail.com">Contact</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li>
          <a href="https://github.com/jsonapi-suite/jsonapi_suite" class="button">Fork on Github</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

        <div class="container">
          <h1 id="quickstart">Quickstart</h1>

<h5 id="zero-to-api-in-10-minutes">Zero to API in 10 minutes</h5>

<p>This quickstart will use Rails with ActiveRecord. Head to the guides
section for usage with alternate ORMs or avoiding Rails
completely.</p>

<h1 id="installation"><a name="installation" href="#installation">Installation</a></h1>

<p>Let’s start with a classic Rails blog:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>rails new blog --api
</code></pre>
</div>

<p>Now add dependencies to your <code class="highlighter-rouge">Gemfile</code>:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'jsonapi_suite'</span>
<span class="n">gem</span> <span class="s1">'jsonapi-rails'</span>
<span class="n">gem</span> <span class="s1">'kaminari'</span>
</code></pre>
</div>

<p>The gem <code class="highlighter-rouge">kaminari</code> is optional (gems like <code class="highlighter-rouge">will_paginate</code> are also supported), but recommended if you’d like easy
pagination out-of-the-box.</p>

<p>Of course now we need to:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle install
</code></pre>
</div>

<p>Now that we’ve installed, let’s bootstrap the suite. This will add a
few files and lines of code you don’t need to worry about right now
(there are comments if you are curious):</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rails g jsonapi_suite:install
</code></pre>
</div>

<p>Finally, let’s set up our routes so that we have a simple versioning
pattern baked-in:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># config/routes.rb</span>
<span class="n">scope</span> <span class="ss">path: </span><span class="s1">'/api'</span> <span class="k">do</span>
  <span class="n">scope</span> <span class="ss">path: </span><span class="s1">'/v1'</span> <span class="k">do</span>
    <span class="c1"># your routes will go here</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>This routing pattern is not required, but you will have to manually add
your own routing if you opt-out.</p>

<h1 id="defining-a-resource"><a name="defining-a-resource" href="#defining-a-resource">Defining a Resource</a></h1>

<p>A <code class="highlighter-rouge">Resource</code> defines how to query and persist your <code class="highlighter-rouge">Model</code>. So first,
let’s define our model:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rails generate model Post title:string active:boolean
<span class="gp">$ </span>bundle <span class="nb">exec </span>rake db:migrate
</code></pre>
</div>

<p>Now we can use the built-in generator to define our <code class="highlighter-rouge">Resource</code>,
controller, and specs:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rails g jsonapi:resource Post
</code></pre>
</div>

<p>You’ll see a number of files created. If you open each one, you’ll see
comments explaining what’s going on. Head over to the
<a href="/tutorial">tutorial</a> for a
more in-depth understanding.</p>

<p>There is a small bit of manual code: specifying the attributes of your
resource. We have to do this in three places: our API inputs (using our
version of <code class="highlighter-rouge">strong_parameters</code>), API outputs (using <a href="http://jsonapi-rb.org">jsonapi-rb</a>,
a library similar to <code class="highlighter-rouge">active_model_serializers</code>), and tests.</p>

<p>Start by specifying which attributes the user should be able to create
and update. This is all configurable, but for now let’s let all <code class="highlighter-rouge">Post</code>
attributes in:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># config/initializers/strong_resources.rb</span>
<span class="n">strong_resource</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="n">attribute</span> <span class="ss">:active</span><span class="p">,</span> <span class="ss">:boolean</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Now specify what attributes you want to serialize as part of the
response:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># app/serializers/serializable_post.rb</span>
<span class="k">class</span> <span class="nc">SerializablePost</span> <span class="o">&lt;</span> <span class="no">JSONAPI</span><span class="o">::</span><span class="no">Serializable</span><span class="o">::</span><span class="no">Resource</span>
  <span class="n">type</span> <span class="ss">:posts</span>

  <span class="n">attribute</span> <span class="ss">:title</span>
  <span class="n">attribute</span> <span class="ss">:active</span>
<span class="k">end</span>
</code></pre>
</div>

<p>And run your app!:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ bundle exec rails s
</code></pre>
</div>

<p>Verify <code class="highlighter-rouge">http://localhost:3000/api/v1/posts</code> renders JSON correctly.
Now we just need data.</p>

<h1 id="seeding-data"><a name="seeding-data" href="#seeding-data">Seeding Data</a></h1>

<p>We can seed data in two ways: the usual <code class="highlighter-rouge">db/seeds.rb</code>, or using an HTTP
client. Using the client helps get your feet wet with client-side
development, or you can avoid the detour and plow right ahead.</p>

<h3 id="seeding-with-ruby"><a name="seeding-with-ruby" href="#seeding-with-ruby">Seeding With Ruby</a></h3>

<p>Edit <code class="highlighter-rouge">db/seeds.rb</code> to create a few <code class="highlighter-rouge">Post</code>s:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Post</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'My title!'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">true</span><span class="p">)</span>
<span class="no">Post</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'Another title!'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">false</span><span class="p">)</span>
<span class="no">Post</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'OMG! A title!'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">true</span><span class="p">)</span>
</code></pre>
</div>

<p>And run the script:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rake db:seed
</code></pre>
</div>

<h3 id="seeding-with-js-client"><a name="seeding-with-node" href="#seeding-with-node">Seeding With JS Client</a></h3>

<p>There are a variety of <a href="http://jsonapi.org/implementations/#client-libraries">JSONAPI Clients</a>
out there. We’ll be using <a href="https://github.com/jsonapi-suite/jsorm">JSORM</a>,
which is built to work with Suite-specific functionality like nested
payloads. It can be used from the browser, but for now we’ll call
it using a simple Node script.</p>

<p>Create the project:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>mkdir node-seed <span class="o">&amp;&amp;</span> <span class="nb">cd </span>node-seed <span class="o">&amp;&amp;</span> touch index.js <span class="o">&amp;&amp;</span> npm init
</code></pre>
</div>

<p>Accept the default for all prompts. Now add the <code class="highlighter-rouge">JSORM</code> dependency, as
well as a polyfill for <code class="highlighter-rouge">fetch</code>:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>npm install --save jsorm isomorphic-fetch
</code></pre>
</div>

<p>Add this seed code to <code class="highlighter-rouge">index.js</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">require</span><span class="p">(</span><span class="s1">'isomorphic-fetch'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">jsorm</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'jsorm'</span><span class="p">);</span>

<span class="c1">// setup code</span>

<span class="kd">var</span> <span class="nx">ApplicationRecord</span> <span class="o">=</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">static</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">baseUrl</span><span class="p">:</span> <span class="s1">'http://localhost:3000'</span><span class="p">,</span>
    <span class="na">apiNamespace</span><span class="p">:</span> <span class="s1">'/api/v1'</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">Post</span> <span class="o">=</span> <span class="nx">ApplicationRecord</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">static</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">jsonapiType</span><span class="p">:</span> <span class="s1">'posts'</span>
  <span class="p">},</span>

  <span class="na">title</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
  <span class="na">active</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">()</span>
<span class="p">});</span>

<span class="nx">jsorm</span><span class="p">.</span><span class="nx">Config</span><span class="p">.</span><span class="nx">setup</span><span class="p">();</span>

<span class="c1">// seed code</span>

<span class="kd">var</span> <span class="nx">post1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'My title!'</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">post2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Another title!'</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">post3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'OMG! A title!'</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="c1">// Save sequentially only due to local development env</span>
<span class="nx">post1</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">post2</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">post3</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>This should be pretty straightforward if you’re familiar with
<code class="highlighter-rouge">ActiveRecord</code>. We define <code class="highlighter-rouge">Model</code> objects, putting configuration on
class attributes. We instatiating instances of those Models, and call
<code class="highlighter-rouge">save()</code> to persist. For more information, see the <a href="https://jsonapi-suite.github.io/jsorm/">JSORM Documentation</a>.</p>

<p>Run the script:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>node index.js
</code></pre>
</div>

<p>Now load <code class="highlighter-rouge">http://localhost:3000/api/v1/posts</code>. You should have 3 <code class="highlighter-rouge">Post</code>s in
your database!</p>

<p><img src="http://localhost:4000/assets/img/3_posts_json.png" alt="3_posts" /></p>

<h1 id="querying"><a name="querying" href="#querying">Querying</a></h1>

<p>Now that we’ve defined our <code class="highlighter-rouge">Resource</code> and seeded some data, let’s see
what query functionality we have. We’ve listed all <code class="highlighter-rouge">Post</code>s at
<code class="highlighter-rouge">http://localhost:3000/api/v1/posts</code>. Let’s see what we can do:</p>

<ul>
  <li><strong>Sort</strong>
    <ul>
      <li>By title, ascending:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?sort=title</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts ORDER BY title ASC</code></li>
        </ul>
      </li>
      <li>By title, descending:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?sort=-title</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts ORDER BY title DESC</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Paginate</strong>:
    <ul>
      <li>2 Per page:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?page[size]=2</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts LIMIT 2</code></li>
        </ul>
      </li>
      <li>2 Per page, second page:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?page[size]=2&amp;page[number]=2</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts LIMIT 2 OFFSET 2</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Sparse Fieldsets</strong>:
    <ul>
      <li>Only render <code class="highlighter-rouge">title</code>, not <code class="highlighter-rouge">active</code>:
        <ul>
          <li>URL: <code class="highlighter-rouge">/api/v1/posts?fields[posts]=title</code></li>
          <li>SQL: <code class="highlighter-rouge">SELECT * from posts</code> (<em>optimizing this query is on the roadmap</em>)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Filter</strong>:
    <ul>
      <li>
        <p>Add one line of code:</p>

        <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># app/resources/post_resource.rb</span>
<span class="n">allow_filter</span> <span class="ss">:title</span>
</code></pre>
        </div>
      </li>
      <li>URL: <code class="highlighter-rouge">/api/v1/posts?filter[title]=My title!</code></li>
      <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts WHERE title = "My title!"</code></li>
      <li>Any filter not whitelisted will raise <code class="highlighter-rouge">JsonapiCompliable::BadFilter</code>
error.</li>
      <li>All filter logic can be customized as one-offs, or packaged into an
<code class="highlighter-rouge">Adapter</code>.</li>
    </ul>
  </li>
  <li><strong>Extra Fields</strong>:
    <ul>
      <li>Sometimes you want to request additional fields not part of a normal
response (perhaps they are computationally expensive).</li>
      <li>
        <p>This can be done like so:</p>

        <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># app/serializers/serializable_post.rb</span>
<span class="n">extra_attribute</span> <span class="ss">:description</span> <span class="k">do</span>
  <span class="vi">@object</span><span class="p">.</span><span class="nf">active?</span> <span class="p">?</span> <span class="s1">'Active Post'</span> <span class="p">:</span> <span class="s1">'Inactive Post'</span>
<span class="k">end</span>
</code></pre>
        </div>
      </li>
      <li>URL: <code class="highlighter-rouge">/api/v1/posts?extra_fields[posts]=description</code></li>
      <li>SQL: <code class="highlighter-rouge">SELECT * FROM posts</code></li>
      <li>You can conditionally eager load data or further customize this
logic. See the tutorial for more.</li>
    </ul>
  </li>
  <li><strong>Statistics</strong>:
    <ul>
      <li>Useful for search grids - “Find me the first 10 active posts, and
the total count of all posts”.</li>
      <li>
        <p>One line of code to whitelist the stat:</p>

        <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># app/resources/post_resource.rb</span>
<span class="n">allow_stat</span> <span class="ss">total: </span><span class="p">[</span><span class="ss">:count</span><span class="p">]</span>
</code></pre>
        </div>
      </li>
      <li>URL: <code class="highlighter-rouge">/api/v1/posts?stats[total]=count</code></li>
      <li>SQL: <code class="highlighter-rouge">SELECT count(*) from posts</code></li>
      <li>Combine with filters and the count will adjust accordingly.</li>
      <li>There are a number of built-in stats, you can also add your own.</li>
      <li>
        <p>This is rendered in the <code class="highlighter-rouge">meta</code> section of the response:</p>

        <p><img src="http://localhost:4000/assets/img/meta_total_count.png" alt="meta_total_count" /></p>
      </li>
    </ul>
  </li>
  <li><strong>Error Handling</strong>:
    <ul>
      <li>Your app will always render a JSONAPI-compliable error response.</li>
      <li>
        <p>Cause an error:</p>

        <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># app/controllers/posts_controller.rb</span>
<span class="k">def</span> <span class="nf">index</span>
  <span class="k">raise</span> <span class="s1">'foo'</span>
<span class="k">end</span>
</code></pre>
        </div>
      </li>
      <li>
        <p>View the default payload:</p>

        <p><img src="http://localhost:4000/assets/img/error_payload.png" alt="error_payload" /></p>
      </li>
      <li>Different errors can be customized with different response codes,
JSON, and side-effects. View <a href="https://jsonapi-suite.github.io/jsonapi_errorable/">jsonapi_errorable</a> for more.</li>
    </ul>
  </li>
</ul>

<h1 id="adding-relationships"><a name="adding-relationships" href="#adding-relationships">Adding Relationships</a></h1>

<p>JSONAPI Suite supports full querying of relationships (“fetch me this
<code class="highlighter-rouge">Post</code> and 3 active <code class="highlighter-rouge">Comment</code>s sorted by creation date”), as well as
persistence (“save this <code class="highlighter-rouge">Post</code> and 3 <code class="highlighter-rouge">Comment</code>s in a single request”).</p>

<h3 id="adding-relationships-1"><a name="relationship-setup" href="#relationship-setup">Adding Relationships</a></h3>

<p>Let’s start by defining our model:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rails g model Comment post_id:integer body:text active:boolean
<span class="gp">$ </span>bundle <span class="nb">exec </span>rake db:migrate
</code></pre>
</div>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># app/models/post.rb</span>
<span class="n">has_many</span> <span class="ss">:comments</span>

<span class="c1"># app/models/comment.rb</span>
<span class="n">belongs_to</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">optional: </span><span class="kp">true</span>
</code></pre>
</div>

<p>…and corresponding <code class="highlighter-rouge">Resource</code> object:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rails g jsonapi:resource Comment
</code></pre>
</div>

<p>Configure the relationship in <code class="highlighter-rouge">PostResource</code>:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">has_many</span> <span class="ss">:comments</span><span class="p">,</span>
  <span class="ss">foreign_key: :post_id</span><span class="p">,</span>
  <span class="ss">resource: </span><span class="no">CommentResource</span><span class="p">,</span>
  <span class="ss">scope: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">all</span> <span class="p">}</span>
</code></pre>
</div>

<p>This code:</p>

<ul>
  <li>Whitelists the relationship.</li>
  <li>Knows to link the objects via <code class="highlighter-rouge">post_id</code>.</li>
  <li>Will use <code class="highlighter-rouge">CommentResource</code> for querying logic.</li>
  <li>Uses an unfiltered base scope (<code class="highlighter-rouge">Comment.all</code>)</li>
</ul>

<p>Now specify the fields we want to output:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># app/serializers/serializable_comment.rb</span>
<span class="n">attribute</span> <span class="ss">:body</span>
<span class="n">attribute</span> <span class="ss">:active</span>
<span class="n">attribute</span> <span class="ss">:created_at</span>
</code></pre>
</div>

<p>And the fields we accept on input:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># config/initializers/strong_resources.rb</span>
<span class="n">strong_resource</span> <span class="ss">:comment</span> <span class="k">do</span>
  <span class="n">attribute</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="n">attribute</span> <span class="ss">:active</span><span class="p">,</span> <span class="ss">:boolean</span>
<span class="k">end</span>
</code></pre>
</div>

<p>You should now be able to hit <code class="highlighter-rouge">/api/v1/comments</code> with all the same
functionality as before. We just need to seed data.</p>

<p>Start by clearing out your database:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rake db:migrate:reset
</code></pre>
</div>

<p>Again, you can seed your data using a NodeJS client or the traditional
<code class="highlighter-rouge">db/seeds.rb</code>.</p>

<h4 id="seeding-with-nodejs"><a name="relationship-seeding-node" href="#relationship-seeding-node">Seeding with NodeJS</a></h4>

<p>Let’s edit our <code class="highlighter-rouge">node-seed/index.js</code>. First add a <code class="highlighter-rouge">Comment</code> model:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Comment</span> <span class="o">=</span> <span class="nx">ApplicationRecord</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">static</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">jsonapiType</span><span class="p">:</span> <span class="s1">'comments'</span>
  <span class="p">},</span>

  <span class="na">body</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
  <span class="na">active</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
  <span class="na">createdAt</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">attr</span><span class="p">()</span>
<span class="p">});</span>
</code></pre>
</div>

<p>…and add the relationship to <code class="highlighter-rouge">Post</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// within class body</span>
<span class="c1">// ... code ...</span>
<span class="nl">comments</span><span class="p">:</span> <span class="nx">jsorm</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">(),</span>
<span class="c1">// ... code...</span>
</code></pre>
</div>

<p>Replace the existing <code class="highlighter-rouge">Post</code> instances with one <code class="highlighter-rouge">Post</code> and three
<code class="highlighter-rouge">Comment</code>s:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">comment1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comment</span><span class="p">({</span>
  <span class="na">body</span><span class="p">:</span> <span class="s1">'comment one'</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">comment2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comment</span><span class="p">({</span>
  <span class="na">body</span><span class="p">:</span> <span class="s1">'comment two'</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">comment3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comment</span><span class="p">({</span>
  <span class="na">body</span><span class="p">:</span> <span class="s1">'comment three'</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'My title!'</span><span class="p">,</span>
  <span class="na">active</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">comments</span><span class="p">:</span> <span class="p">[</span><span class="nx">comment1</span><span class="p">,</span> <span class="nx">comment2</span><span class="p">,</span> <span class="nx">comment3</span><span class="p">]</span>
<span class="p">});</span>

<span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span> <span class="na">with</span><span class="p">:</span> <span class="p">[</span><span class="s1">'comments'</span><span class="p">]</span> <span class="p">});</span>
</code></pre>
</div>

<p>Tell our controller it’s OK to sidepost comments:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">strong_resource</span> <span class="ss">:post</span> <span class="k">do</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Now run the script to persist the <code class="highlighter-rouge">Post</code> and its three <code class="highlighter-rouge">Comment</code>s in a
single request:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>node node-seed/index.js
</code></pre>
</div>

<h4 id="seeding-with-ruby-1"><a name="relationship-seeding-ruby" href="#relationship-seeding-ruby">Seeding with Ruby</a></h4>

<p>Replace your <code class="highlighter-rouge">db/seeds.rb</code> with this code to persist one <code class="highlighter-rouge">Post</code> and
three <code class="highlighter-rouge">Comment</code>s:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">comment1</span> <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">body: </span><span class="s1">'comment one'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">true</span><span class="p">)</span>
<span class="n">comment2</span> <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">body: </span><span class="s1">'comment two'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">false</span><span class="p">)</span>
<span class="n">comment3</span> <span class="o">=</span> <span class="no">Comment</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">body: </span><span class="s1">'comment three'</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">true</span><span class="p">)</span>

<span class="no">Post</span><span class="p">.</span><span class="nf">create!</span> <span class="p">\</span>
  <span class="ss">title: </span><span class="s1">'My title!'</span><span class="p">,</span>
  <span class="ss">active: </span><span class="kp">true</span><span class="p">,</span>
  <span class="ss">comments: </span><span class="p">[</span><span class="n">comment1</span><span class="p">,</span> <span class="n">comment2</span><span class="p">,</span> <span class="n">comment3</span><span class="p">]</span>
</code></pre>
</div>

<h2 id="usage"><a name="relationship-usage" href="#relationship-usage">Usage</a></h2>

<p>Now let’s fetch a <code class="highlighter-rouge">Post</code> and filtered <code class="highlighter-rouge">Comment</code>s in a single request: <code class="highlighter-rouge">/api/v1/posts?include=comments</code>.</p>

<p>Any logic in <code class="highlighter-rouge">CommentResource</code> is available to us. Let’s sort the
comments by <code class="highlighter-rouge">created_at</code> descending: <code class="highlighter-rouge">/api/v1/posts?include=comments&amp;sort=-comments.created_at</code>. This should work out-of-the-box.</p>

<p>Now add a filter to <code class="highlighter-rouge">CommentResource</code>:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">allow_filter</span> <span class="ss">:active</span>
</code></pre>
</div>

<p>That filter now works in two places:</p>

<ul>
  <li><code class="highlighter-rouge">/api/v1/comments?filter[active]=true</code></li>
  <li><code class="highlighter-rouge">/api/v1/posts?include=comments&amp;filter[comments][active]=true</code></li>
</ul>

<p>This is why <code class="highlighter-rouge">Resource</code> objects exist: they provide an interface to
functionality shared across many different endpoints, with no extra
code.</p>

<h1 id="whats-next"><a name="whats-next" href="#whats-next">What’s Next</a></h1>

<p>We have a full CRUD API with robust querying functionality, and the
ability to combine relationships for both reads and writes. But what
happens when you need to customize the sorting logic? What replacing
<code class="highlighter-rouge">ActiveRecord</code> with an alternate persistence layer, or avoiding Rails
altogether?</p>

<p>These are important topics that JSONAPI Suite was built to address. To
learn more about advanced usage and customization, we suggest following
the <a href="/tutorial">tutorial</a>.</p>

<p>For additional documentation, view the <a href="https://jsonapi-suite.github.io/jsonapi_compliable/">YARD Docs</a>.
For help with specific use cases, join our Slack chat at https://jsonapi-suite.slack.com (email <a href="mailto:richmolj@gmail.com">richmolj@gmail.com</a> for an invite).</p>

<h1 id="bonus-testing"><a name="testing" href="#testing">Bonus: Testing</a></h1>

<h3 id="installation-1"><a name="testing-install" href="#testing-install">Installation</a></h3>

<p>Sharp eyes may have noticed we generated a number of spec files. Before
running these tests, we need to install and set up dependencies:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># Gemfile</span>
<span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rspec-rails'</span>
  <span class="n">gem</span> <span class="s1">'factory_girl_rails'</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'database_cleaner'</span>
  <span class="n">gem</span> <span class="s1">'faker'</span>
  <span class="n">gem</span> <span class="s1">'jsonapi_spec_helpers'</span><span class="p">,</span> <span class="ss">require: </span><span class="kp">false</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Only RSpec and <code class="highlighter-rouge">jsonapi_spec_helpers</code> are required, the rest are sensible defaults:</p>

<ul>
  <li><a href="https://github.com/thoughtbot/factory_girl">factory_girl</a> for
  seeding our test database with fake data.</li>
  <li><a href="https://github.com/stympy/faker">faker</a> for generating fake values,
  such as e-mail addresses, names, avatar URLs, etc.</li>
  <li><a href="https://github.com/DatabaseCleaner/database_cleaner">database_cleaner</a>
  to ensure our fake data gets cleaned up between test runs.</li>
</ul>

<p>Now let’s install everything and bootstrap RSpec:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle install <span class="o">&amp;&amp;</span> bundle <span class="nb">exec </span>rails g rspec:install
</code></pre>
</div>

<p>Edit <code class="highlighter-rouge">spec/rails_helper.rb</code> to add JSONAPI Suite <a href="https://jsonapi-suite.github.io/jsonapi_spec_helpers">spec helpers</a>:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'jsonapi_spec_helpers'</span>

<span class="c1"># ... code ...</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># ... code ...</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">include</span> <span class="no">JsonapiSpecHelpers</span>
<span class="k">end</span>
</code></pre>
</div>

<p>And the <code class="highlighter-rouge">factory_girl</code> helpers:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># ... code ...</span>
<span class="n">config</span><span class="p">.</span><span class="nf">include</span> <span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span>
</code></pre>
</div>

<p>And the <code class="highlighter-rouge">database_cleaner</code> glue code:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># ... code ...</span>
<span class="n">config</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:suite</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">DatabaseCleaner</span><span class="p">.</span><span class="nf">strategy</span> <span class="o">=</span> <span class="ss">:transaction</span>
  <span class="no">DatabaseCleaner</span><span class="p">.</span><span class="nf">clean_with</span><span class="p">(</span><span class="ss">:truncation</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">config</span><span class="p">.</span><span class="nf">around</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
  <span class="k">begin</span>
    <span class="no">DatabaseCleaner</span><span class="p">.</span><span class="nf">cleaning</span> <span class="k">do</span>
      <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="k">end</span>
  <span class="k">ensure</span>
    <span class="no">DatabaseCleaner</span><span class="p">.</span><span class="nf">clean</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>In following this guide, we generated <code class="highlighter-rouge">Post</code> and
<code class="highlighter-rouge">Comment</code> resources. But - to avoid the overhead of testing during a
quickstart - we didn’t have <code class="highlighter-rouge">factory_girl</code> installed when we ran those
generators. Let’s go ahead and add those files now:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># spec/factories/post.rb</span>
<span class="no">FactoryGirl</span><span class="p">.</span><span class="nf">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:post</span> <span class="k">do</span>
    <span class="n">title</span> <span class="p">{</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Lorem</span><span class="p">.</span><span class="nf">sentence</span> <span class="p">}</span>
    <span class="n">active</span> <span class="p">{</span> <span class="p">[</span><span class="kp">true</span><span class="p">,</span> <span class="kp">false</span><span class="p">].</span><span class="nf">sample</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># spec/factories/comment.rb</span>
<span class="no">FactoryGirl</span><span class="p">.</span><span class="nf">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:comment</span> <span class="k">do</span>
    <span class="n">body</span> <span class="p">{</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Lorem</span><span class="p">.</span><span class="nf">paragraph</span> <span class="p">}</span>
    <span class="n">active</span> <span class="p">{</span> <span class="p">[</span><span class="kp">true</span><span class="p">,</span> <span class="kp">false</span><span class="p">].</span><span class="nf">sample</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Finally, we need to define a <code class="highlighter-rouge">Payload</code>. <code class="highlighter-rouge">Payload</code>s use a
<code class="highlighter-rouge">factory_girl</code>-style DSL to define expected JSON. A <code class="highlighter-rouge">Payload</code> compares a
<code class="highlighter-rouge">Model</code> instance and JSON output, ensuring:</p>

<ul>
  <li>No unexpected keys</li>
  <li>No missing keys</li>
  <li>No unexpected value types</li>
  <li>No <code class="highlighter-rouge">null</code> values (this is overrideable)</li>
  <li>Model attribute matches JSON attribute</li>
  <li>This can all be customized. See <a href="https://github.com/jsonapi-suite/jsonapi_spec_helpers">jsonapi_spec_helpers</a> for more.</li>
</ul>

<p>Let’s define our payloads now:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># spec/payloads/post.rb</span>
<span class="no">JsonapiSpecHelpers</span><span class="o">::</span><span class="no">Payload</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:active</span><span class="p">,</span> <span class="p">[</span><span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span><span class="p">])</span>
<span class="k">end</span>

<span class="c1"># spec/payloads/comment.rb</span>
<span class="no">JsonapiSpecHelpers</span><span class="o">::</span><span class="no">Payload</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="ss">:comment</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:body</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:active</span><span class="p">,</span> <span class="p">[</span><span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span><span class="p">])</span>
  <span class="n">key</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">,</span> <span class="no">Time</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>

<h3 id="run"><a name="testing-run" href="#testing-rub">Run</a></h3>

<p>We can now run specs. Let’s start with the <code class="highlighter-rouge">Post</code> specs:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rspec spec/api/v1/posts
</code></pre>
</div>

<p>You should see five specs, with one failing (<code class="highlighter-rouge">spec/api/v1/posts/create_spec.rb</code>),
and one pending (<code class="highlighter-rouge">spec/api/v1/posts/update_spec.rb</code>).</p>

<p>The reason for the failure is simple: our payload defined in
<code class="highlighter-rouge">spec/payloads/post.rb</code> specifies that a <code class="highlighter-rouge">Post</code> JSON should include the
key <code class="highlighter-rouge">title</code>. However, that spec is currently creating a <code class="highlighter-rouge">Post</code> with no
attributes…which means in the response JSON, <code class="highlighter-rouge">title</code> is <code class="highlighter-rouge">null</code>. <code class="highlighter-rouge">null</code>
values will fail <code class="highlighter-rouge">assert_payload</code> unless elsewise configured.</p>

<p>So, let’s update our spec to POST attributes, not just an empty object:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">let</span><span class="p">(</span><span class="ss">:payload</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span>
    <span class="ss">data: </span><span class="p">{</span>
      <span class="ss">type: </span><span class="s1">'posts'</span><span class="p">,</span>
      <span class="ss">attributes: </span><span class="p">{</span>
        <span class="ss">title: </span><span class="s1">'My title!'</span><span class="p">,</span>
        <span class="ss">active: </span><span class="kp">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Your specs should now pass. The only pending spec is due to a similar
issue - we need to specify attributes in <code class="highlighter-rouge">spec/api/v1/posts/update_spec.rb</code> as
well. Follow the comments in that file to apply a similar change.</p>

<p>You should now have 5 passing request specs! These specs spin up a fake
server, then execute full-stack requests that hit the database and
return JSON. You’re asserting that JSON matches predefined payloads,
without <code class="highlighter-rouge">null</code>s or unknown key/values.</p>

<p>Go ahead and make the same changes to <code class="highlighter-rouge">Comment</code> specs to get 10 passing
request specs.</p>

<p>It’s up to you how far you’d like to go with testing. Should you add a
new spec to <code class="highlighter-rouge">spec/api/v1/posts/index_spec.rb</code> every time you add a
filter with <code class="highlighter-rouge">allow_filter</code>? This boils down to personal preference and
tolerance of failures. Try adding a few specs following the generated
patterns to get a feel for what’s right for you.</p>

<h3 id="bonus-documentation"><a name="documentation" href="#documentation">Bonus: Documentation</a></h3>

<p>TODO! Automatic <a href="https://swagger.io">swagger documentation</a> is coming
shortly.</p>

<p><br />
<br />
<br /></p>

<script type="text/javascript">
  $(function () {
    hljs.configure({
      tabReplace: '  ',
      classPrefix: ''
    });

    $('.language-ruby code').addClass('ruby');
    $('.language-javascript code').addClass('javascript');

    hljs.initHighlightingOnLoad();
  });
</script>


        </div>
      </div>
    </main>
    <div class="main-footer main-footer--dark">
  <div class="container">
    <div class="row">
      <div class="col-sm-4 menu">
        <h3>Overview</h3>
        <ul>
          <li>
            <a href="http://localhost:4000/quickstart">Quickstart</a>
          </li>
          <li>
            <a href="http://localhost:4000/tutorial">Tutorial</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-4 menu">
        <h3>Resources</h3>
        <ul>
          <li>
            <a target="_blank" href="https://jsonapi-suite.github.io/jsonapi_compliable">YARD Documentation</a>
          </li>
          <li>
            <a target="_blank" href="https://jsonapi-suite.slack.com/">Slack Chat</a>
          </li>
          <li>
            <a href="mailto:richmolj@gmail.com">Contact us</a>
          </li>
        </ul>
      </div>
      <div class="col-sm-4 menu">
        <h3>Related</h3>
        <ul>
          <li>
            <a target="_blank" href="http://jsonapi.org">JSONAPI Spec</a>
          </li>
          <li>
            <a target="_blank" href="http://jsonapi-rb.org">jsonapi-rb</a>
          </li>
          <li>
            <a target="_blank" href="https://glimmerjs.com">Glimmer</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

  </body>
</html>
